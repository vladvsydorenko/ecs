!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var i in n)("object"==typeof exports?exports:t)[i]=n[i]}}(window,function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){"use strict";var i,s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.set="set",t.unset="unset"}(i=e.EEntityManagerEventTypes||(e.EEntityManagerEventTypes={}));var r=function(){function t(t){void 0===t&&(t={}),this.length=0,this.listeners={},this.nextEntityId=0,this.nextListenerId=0,this.entities=t,this.lastUpdated=Date.now()}return t.prototype.set=function(t){var e=void 0!==t.id?t.id:"entity_"+this.nextEntityId++,n=this.entities[e]=Object.freeze(s({},t,{id:e}));return this.length=Object.keys(this.entities).length,this.lastUpdated=Date.now(),this.notify(i.set,n),n},t.prototype.unset=function(t){if(!this.entities[t.id])throw new Error('Attempt to unset not existed entity by id "'+t.id+'"');delete this.entities[t.id],this.length=Object.keys(this.entities).length,this.lastUpdated=Date.now(),this.notify(i.unset,t)},t.prototype.on=function(t,e,n){var i=this.nextListenerId++;return(this.listeners[t]||(this.listeners[t]=[])).push({id:i,fn:e,context:n}),i},t.prototype.off=function(t){var e=this;Object.keys(this.listeners).forEach(function(n){var i;e.listeners[n].some(function(e,n){if(e.id===t)return i=n,!0}),void 0!==i&&(e.listeners[n].splice(i,1),0===e.listeners[n].length&&delete e.listeners[n])})},t.prototype.toArray=function(){var t=this;return Object.keys(this.entities).map(function(e){return t.entities[e]})},t.prototype.forEach=function(t){this.toArray().forEach(t)},t.prototype.filter=function(t){return this.toArray().filter(t)},t.prototype.find=function(t){return this.toArray().find(t)},t.prototype.some=function(t){return this.toArray().some(t)},t.prototype.every=function(t){return this.toArray().every(t)},t.prototype.notify=function(t,e){var n=this.listeners[t];n&&n.forEach(function(t){t.context?t.fn.call(t.context,e):t.fn(e)})},t}();e.EntityManager=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0);e.EntityManager=i.EntityManager,e.EEntityManagerEventTypes=i.EEntityManagerEventTypes;var s=n(2);e.SystemManager=s.SystemManager},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),s=function(){function t(t){this.systems=[],this.emListenerIds=[],this.isInUpdate=!1,this.nextSystemId=0,this.updateTimeoutId=null,this.em=t}return t.prototype.start=function(){var t=this.em;this.systems.forEach(function(e){var n=e.system;return n.start&&n.start(t)}),this.emListenerIds.push(t.on(i.EEntityManagerEventTypes.set,this.onUpdate,this)),this.emListenerIds.push(t.on(i.EEntityManagerEventTypes.unset,this.onUpdate,this)),this.systems.length>0&&this.em.length>0&&this.update()},t.prototype.stop=function(){var t=this;this.emListenerIds.forEach(function(e){return t.em.off(e)})},t.prototype.add=function(t){var e=this.nextSystemId++;return this.systems.push({id:e,system:t,lastUpdated:null}),e},t.prototype.remove=function(t){var e=-1;if(this.systems.some(function(n,i){if(n.id===t)return e=i,!0}),-1===e)throw new Error('Attempt to remove not added system with id "'+t+'"');this.systems.splice(e,1)},t.prototype.update=function(){var t=this.em;this.isInUpdate=!0,this.systems.forEach(function(e){e.lastUpdated!==t.lastUpdated&&(e.system.update(t),e.lastUpdated=t.lastUpdated)}),this.isInUpdate=!1},t.prototype.onUpdate=function(){var t=this;this.isInUpdate?(clearTimeout(this.updateTimeoutId),this.updateTimeoutId=setTimeout(function(){return t.onUpdate()})):this.update()},t}();e.SystemManager=s}])});